
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Troubleshooting Deployment Â· Cumulus Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="iam_roles.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Documentation</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Home
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../architecture.html">
            
                <a href="../architecture.html">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../workflows/">
            
                <a href="../workflows/">
            
                    
                    What are Cumulus Workflows?
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../workflows/protocol.html">
            
                <a href="../workflows/protocol.html">
            
                    
                    Workflow Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../tasks.html">
            
                <a href="../tasks.html">
            
                    
                    Workflow Tasks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../workflows/input_output.html">
            
                <a href="../workflows/input_output.html">
            
                    
                    Workflow Input & Ouptut
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../workflows/cumulus-task-message-flow.html">
            
                <a href="../workflows/cumulus-task-message-flow.html">
            
                    
                    Workflow Task Message Flow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../workflows/developing-workflow-tasks.html">
            
                <a href="../workflows/developing-workflow-tasks.html">
            
                    
                    Developing Workflow Tasks
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="../workflows/lambda.html">
            
                <a href="../workflows/lambda.html">
            
                    
                    Lambda Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5.2" data-path="../workflows/docker.html">
            
                <a href="../workflows/docker.html">
            
                    
                    Dockerization
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../workflows/workflow-configuration-how-to.html">
            
                <a href="../workflows/workflow-configuration-how-to.html">
            
                    
                    Workflow Configuration How-to's
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Deployment
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="./">
            
                <a href="./">
            
                    
                    How to Deploy Cumulus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="create_bucket.html">
            
                <a href="create_bucket.html">
            
                    
                    Creating an S3 Bucket
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="iam_roles.html">
            
                <a href="iam_roles.html">
            
                    
                    Locating IAMs
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.4" data-path="troubleshoot_deployment.html">
            
                <a href="troubleshoot_deployment.html">
            
                    
                    Troubleshooting Deployment
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <a target="_blank" href="https://nasa.github.io/cumulus-api">
            
                    
                    Cumulus API Docs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Additional Cumulus Features
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../data_in_dynamodb.html">
            
                <a href="../data_in_dynamodb.html#cumulus-metadata-in-dynamodb">
            
                    
                    Cumulus Metadata in DynamoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../data_in_dynamodb.html">
            
                <a href="../data_in_dynamodb.html#backup-and-restore-with-aws">
            
                    
                    DynamoDB Backup and Restore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../data_in_dynamodb.html">
            
                <a href="../data_in_dynamodb.html#dynamodb-auto-scaling">
            
                    
                    DynamoDB Auto Scaling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../ems_reporting.html">
            
                <a href="../ems_reporting.html">
            
                    
                    EMS Reporting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <a target="_blank" href="https://github.com/nasa/cumulus/blob/master/CHANGELOG.md">
            
                    
                    Changelog
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../upgrade/">
            
                <a href="../upgrade/">
            
                    
                    Upgrade Instructions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../upgrade/1.6.0.html">
            
                <a href="../upgrade/1.6.0.html">
            
                    
                    1.6.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../upgrade/1.7.0.html">
            
                <a href="../upgrade/1.7.0.html">
            
                    
                    1.7.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../upgrade/1.9.0.html">
            
                <a href="../upgrade/1.9.0.html">
            
                    
                    1.9.0
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../system-documentation/system-documentation.html">
            
                <a href="../system-documentation/system-documentation.html">
            
                    
                    Operating and Troubleshooting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../doc_installation.html">
            
                <a href="../doc_installation.html">
            
                    
                    Contributing to documentation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../adding-a-task.html">
            
                <a href="../adding-a-task.html">
            
                    
                    Contributing a task
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../team.html">
            
                <a href="../team.html">
            
                    
                    Team
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Data Cookbook</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../data-cookbooks/about-cookbooks.html">
            
                <a href="../data-cookbooks/about-cookbooks.html">
            
                    
                    About Cookbooks
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../data-cookbooks/setup.html">
            
                <a href="../data-cookbooks/setup.html">
            
                    
                    Collections, Providers, Schemas, and Rules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../data-cookbooks/hello-world.html">
            
                <a href="../data-cookbooks/hello-world.html">
            
                    
                    HelloWorldWorkflow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../data-cookbooks/sns.html">
            
                <a href="../data-cookbooks/sns.html">
            
                    
                    SNS Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../data-cookbooks/sips-workflow.html">
            
                <a href="../data-cookbooks/sips-workflow.html">
            
                    
                    SIPS Workflow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../data-cookbooks/error-handling.html">
            
                <a href="../data-cookbooks/error-handling.html">
            
                    
                    Error Handling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../data-cookbooks/choice-states.html">
            
                <a href="../data-cookbooks/choice-states.html">
            
                    
                    Choice States
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Troubleshooting Deployment</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="troubleshooting-cumulus-deployment">Troubleshooting Cumulus Deployment</h1>
<p>This document provides &apos;notes&apos; on frequently encountered deployment issues. The issues reported are organized by relevant subsection.</p>
<h3 id="configuring-the-cumulus-stack">Configuring the Cumulus Stack</h3>
<h4 id="vpc">VPC</h4>
<p>Issues:</p>
<ul>
<li><p>If redeploying an existing configuration you may already have at least 1 vpc associated with your existing deployment, but its subnets can be transitory in nature depending on what kind of load balancing and/or docker activities are taking place at a given time.  You should  identify at least one persistent subnet to use as a subnet ID (you may only specify one) for use.    If this is needed, navigate to  <a href="https://console.aws.amazon.com/ec2/autoscaling/home?region=us-east-1#AutoScalingGroups:view=details" target="_blank">AWS EC2 &gt; Auto Scaling Groups</a> and note the &quot;Availability Zone&quot; (e.g., us-east-1a). Next, visit <a href="https://console.aws.amazon.com/vpc/home" target="_blank">AWS VPC</a> and click on &quot;Subnets&quot;. Copy the &apos;VPC&apos; value into &apos;vpcId&apos; and the appropriate &apos;Subnet ID&apos; value, based on the Availability Zone value you just saw on the Auto Scaling Groups page, into &apos;subnets&apos;. If you have no vpc and/or subnets, do not include the vpc section in your new configuration.</p>
<p>Example config:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">vpc:</span>
<span class="hljs-attr">vpcId:</span> vpc<span class="hljs-bullet">-1234</span>abcd
<span class="hljs-attr">subnets:</span>
<span class="hljs-bullet">  -</span> subnet<span class="hljs-bullet">-1234</span>ancd

<span class="hljs-attr">ecs:</span>
<span class="hljs-attr">instanceType:</span> t2.micro
<span class="hljs-attr">desiredInstances:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">availabilityZone:</span> us-east<span class="hljs-bullet">-1</span>a
</code></pre>
</li>
</ul>
<h3 id="deploying-the-cumulus-stack">Deploying the Cumulus Stack</h3>
<p>Monitoring the progress of stack deployment can be done from the <a href="https://console.aws.amazon.com/cloudformation/home" target="_blank">AWS CloudFormation Console</a>.</p>
<p>Issues:</p>
<h4 id="error-the-availability-zones-of-the-specified-subnets-and-the-auto-scaling-group-do-not-match"><strong>Error:</strong> __&quot;The availability zones of the specified subnets and the Auto Scaling group do not match&quot;</h4>
<p>See <a href="#vpc">vpc issues</a></p>
<h4 id="error-stack-is-in-rollbackcomplete-or-rollbackfailed-state-and-can-not-be-updated">Error: Stack.. is in ROLLBACK_COMPLETE (or ROLLBACK_FAILED) state and can not be updated.</h4>
<p>The stack cannot be re-deployed if it is currently in ROLLBACK_COMPLETE or ROLLBACK_FAILED.</p>
<p>If this is a new deployment, delete the stack and try deploying again.</p>
<p>You may be able to continue the rollback operation. At the top of the CloudFormation page for the stack, click the &apos;Other Actions&apos; dropdown and choose to continue rollback.</p>
<p>In the advanced settings when continuing rollback, you can enter the logical Ids of resources to skip that are preventing rollback. These ids can be found in the resources section of the CloudFormation page for the stack.</p>
<h4 id="failure-on-nested-stacks">Failure on nested stacks</h4>
<p>If the deployment failed on nested stacks (CumulusApiDefaultNestedStack, CumulusApiV1NestedStack), and the nested stacks are gone due to rollback.  Try to deploy the just the main stack first by adding a nested_template parameter set to null in your stack config app/config.yml file, and then run the deployment.</p>
<pre><code>&lt;your deployment&gt;:
  nested_template: null
  stackName: &lt;stackname&gt;
</code></pre><p>When the main stack is in &apos;CREATE_COMPLETE&apos; state from the AWS console (ignore the kes error { BadRequestException: The REST API doesn&apos;t contain any methods}), remove the &apos;nested_template&apos; line and redeploy again.  Then the nested stacks will stay, and you can debug the errors.</p>
<h3 id="install-dashboard">Install dashboard</h3>
<h4 id="dashboard-configuration">Dashboard configuration</h4>
<p>Issues:</p>
<ul>
<li><p><strong>Problem clearing the cache: EACCES: permission denied, rmdir &apos;/tmp/gulp-cache/default&apos;</strong>&quot;, this probably means the files at that location, and/or the folder, are owned by someone else (or some other factor prevents you from writing there).</p>
<p>It&apos;s possible to workaround this by editing the file <code>cumulus-dashboard/node_modules/gulp-cache/index.js</code> and alter the value of the line <code>var fileCache = new Cache({cacheDirName: &apos;gulp-cache&apos;});</code> to something like <code>var fileCache = new Cache({cacheDirName: &apos;&lt;prefix&gt;-cache&apos;});</code>. Now gulp-cache will be able to write to <code>/tmp/&lt;prefix&gt;-cache/default</code>, and the error should resolve.</p>
</li>
</ul>
<h4 id="dashboard-deployment">Dashboard deployment</h4>
<p>Issues:</p>
<ul>
<li><p>If the dashboard sends you to an Earthdata Login page that has an error reading <strong>&quot;Invalid request, please verify the client status or redirect_uri before resubmitting&quot;</strong>, this means you&apos;ve either forgotten to update one or more of your EARTHDATA_CLIENT_ID, EARTHDATA_CLIENT_PASSWORD environment variables (from your app/.env file) and re-deploy Cumulus, or you haven&apos;t placed the correct values in theml, or you&apos;ve forgotten to add both the &quot;redirect&quot; and &quot;token&quot; URL to the Earthdata Application.</p>
</li>
<li><p>There is odd caching behavior associated with the dashboard and Earthdata Login at this point in time that can cause the above error to reappear on the Earthdata Login page loaded by the dashboard even after fixing the cause of the error. If you experience this, attempt to access the dashboard in a new browser window, and it should work.</p>
</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="iam_roles.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Locating IAMs">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Troubleshooting Deployment","level":"1.4.4","depth":2,"next":{"title":"Cumulus API Docs","level":"1.5","depth":1,"url":"https://nasa.github.io/cumulus-api","ref":"https://nasa.github.io/cumulus-api","articles":[]},"previous":{"title":"Locating IAMs","level":"1.4.3","depth":2,"path":"deployment/iam_roles.md","ref":"deployment/iam_roles.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"root":"docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Cumulus Documentation","gitbook":"*"},"file":{"path":"deployment/troubleshoot_deployment.md","mtime":"2018-08-31T14:24:16.984Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-08-31T14:25:31.463Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

